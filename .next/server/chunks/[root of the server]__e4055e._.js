module.exports = {

"[externals]/next/dist/compiled/next-server/app-route.runtime.dev.js [external] (next/dist/compiled/next-server/app-route.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/compiled/next-server/app-route.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page.runtime.dev.js [external] (next/dist/compiled/next-server/app-page.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/compiled/next-server/app-page.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[project]/src/lib/tokensData.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: __turbopack_require_stub__ } = __turbopack_context__;
{
__turbopack_esm__({
    "topEthereumTokenSymbols": (()=>topEthereumTokenSymbols),
    "topEthereumTokensMetadata": (()=>topEthereumTokensMetadata)
});
const topEthereumTokensMetadata = {
    //used wETH instead of ETH since WETH used for DeFi
    WBTC: {
        name: "Wrapped Bitcoin",
        symbol: "WBTC",
        smartContract: "0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599"
    },
    STETH: {
        name: "Lido Staked Ether",
        symbol: "stETH",
        smartContract: "0xae7ab96520DE3A18E5e111B5EaAb095312D7fE84"
    },
    WETH: {
        name: "Wrapped Ethereum",
        symbol: "WETH",
        smartContract: "0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"
    },
    MATIC: {
        name: "Polygon",
        symbol: "MATIC",
        smartContract: "0x7d1afa7b718fb893db30a3abc0cfc608aacfebb0"
    },
    USDT: {
        name: "Tether",
        symbol: "USDT",
        smartContract: "0xdAC17F958D2ee523a2206206994597C13D831ec7"
    },
    USDC: {
        name: "USD Coin",
        symbol: "USDC",
        smartContract: "0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eb48"
    },
    DAI: {
        name: "Dai",
        symbol: "DAI",
        smartContract: "0x6B175474E89094C44Da98b954EedeAC495271d0F"
    },
    SHIB: {
        name: "Shiba Inu",
        symbol: "SHIB",
        smartContract: "0x95aD61b0a150d79219dCF64E1E6Cc01f0B64C4cE"
    }
};
const topEthereumTokenSymbols = Object.keys(topEthereumTokensMetadata);
}}),
"[project]/src/lib/queries.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: __turbopack_require_stub__ } = __turbopack_context__;
{
__turbopack_esm__({
    "token24HrPricesQuery": (()=>token24HrPricesQuery)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$tokensData$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/lib/tokensData.ts [app-route] (ecmascript)");
;
const token24HrPricesQuery = (yesterdayUTC)=>{
    return Object.values(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$tokensData$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["topEthereumTokensMetadata"]).map((token)=>`query {
            EVM(dataset: combined) {
              DEXTrades(
                orderBy: {descending: Block_Time}
                where: {Trade: {Success: true, Buy: {Currency: {SmartContract: {is: "${token.smartContract}"}}, PriceInUSD: {gt: 0}}}, Block: {Time: {after: "${yesterdayUTC}"}}}
              ) {
                Trade {
                  Buy {
                    PriceInUSD
                  }
                }
              }
            }
          }`);
};
}}),
"[project]/src/app/api/token-data/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: __turbopack_require_stub__ } = __turbopack_context__;
{
__turbopack_esm__({
    "POST": (()=>POST)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$queries$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/lib/queries.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$tokensData$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/lib/tokensData.ts [app-route] (ecmascript)");
;
;
const { BITQUERY_ACCESS_TOKEN, BITQUERY_GRAPHQL_URL } = process.env;
async function POST() {
    if (!BITQUERY_ACCESS_TOKEN || !BITQUERY_GRAPHQL_URL) {
        console.error("Missing Bitquery Access Token or URL");
        return new Response(JSON.stringify({
            error: "Missing Bitquery Access Token or URL"
        }), {
            status: 500
        });
    }
    const yesterdayUTC = new Date(Date.now() - 86400000).toISOString();
    const queries = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$queries$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["token24HrPricesQuery"])(yesterdayUTC);
    try {
        const formattedData = await Promise.all(queries.map(async (query, index)=>{
            const response = await fetch(BITQUERY_GRAPHQL_URL, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${BITQUERY_ACCESS_TOKEN}`
                },
                body: JSON.stringify({
                    query
                })
            });
            if (!response.ok) {
                console.error("Error response from Bitquery:", response);
                throw new Error(`Error fetching data from Bitquery: ${response.statusText}`);
            }
            const data = await response.json();
            const tokenData = data.data.EVM.DEXTrades;
            if (!tokenData) return null;
            const prices = tokenData.map((item)=>item?.Trade?.Buy?.PriceInUSD || 0);
            const maxPrice = Math.max(...prices);
            const minPrice = Math.min(...prices);
            const firstPrice = prices[0] ?? 0;
            const lastPrice = prices[prices.length - 1] ?? 0;
            const numBuys = prices.length;
            const symbol = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$tokensData$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["topEthereumTokenSymbols"][index] ?? "";
            const name = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$tokensData$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["topEthereumTokensMetadata"][symbol]?.name ?? "";
            return {
                name: name,
                symbol: symbol,
                currPriceUSD: firstPrice,
                volatility: estimateVolatility({
                    high: maxPrice,
                    low: minPrice
                }),
                priceMove: lastPrice === 0 ? 0 : (firstPrice - lastPrice) / lastPrice,
                volume: numBuys
            };
        }));
        // remove any null entries
        const result = formattedData.filter((item)=>item !== null);
        return new Response(JSON.stringify(result), {
            status: 200,
            headers: {
                "Content-Type": "application/json"
            }
        });
    } catch (error) {
        console.error("Error fetching and parsing Bitquery data:", error);
        return new Response(JSON.stringify({
            error: "Failed to fetch and parse data"
        }), {
            status: 500
        });
    }
}
// using parkinson’s volatility estimator (https://www.ivolatility.com/education/parkinsons-historical-volatility/)
function estimateVolatility({ high, low, timePeriod = 1 }) {
    console.log(high);
    console.log(low);
    const lowVal = low !== 0 ? low : 0.0001;
    if (high <= 0 || lowVal < 0 || high <= low) {
        throw new Error("Invalid high or low price values.");
    }
    const volatility = (Math.log(high) - Math.log(low)) / Math.sqrt(4 * Math.log(2) * timePeriod);
    return volatility;
}
}}),
"[project]/ (server-utils)": ((__turbopack_context__) => {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, t: __turbopack_require_real__ } = __turbopack_context__;
{
}}),

};

//# sourceMappingURL=%5Broot%20of%20the%20server%5D__e4055e._.js.map